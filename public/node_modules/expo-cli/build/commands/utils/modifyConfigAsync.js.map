{"version":3,"sources":["../../../src/commands/utils/modifyConfigAsync.ts"],"names":["attemptModification","projectRoot","edits","exactEdits","modification","skipSDKVersionRequirement","type","Log","addNewLineIfNone","warnAboutConfigAndThrow","message","logNoConfig","log","chalk","yellow","bold","attemptAddingPluginsAsync","exp","plugins","length","Set","concat","skipPlugins","join","notifyAboutManualConfigEdits","SilentError","cyan","newLine","JSON","stringify"],"mappings":";;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEO,eAAeA,mBAAf,CACLC,WADK,EAELC,KAFK,EAGLC,UAHK,EAIU;AACf,QAAMC,YAAY,GAAG,MAAM,iCAAkBH,WAAlB,EAA+BC,KAA/B,EAAsC;AAC/DG,IAAAA,yBAAyB,EAAE;AADoC,GAAtC,CAA3B;;AAGA,MAAID,YAAY,CAACE,IAAb,KAAsB,SAA1B,EAAqC;AACnCC,mBAAIC,gBAAJ;AACD,GAFD,MAEO;AACLC,IAAAA,uBAAuB,CAACL,YAAY,CAACE,IAAd,EAAoBF,YAAY,CAACM,OAAjC,EAA2CP,UAA3C,CAAvB;AACD;AACF;;AAED,SAASQ,WAAT,GAAuB;AACrBJ,iBAAIK,GAAJ,CACEL,eAAIM,KAAJ,CAAUC,MAAV,CACG,2DAA0DP,eAAIM,KAAJ,CAAUE,IAAK,UAAU,OAAMR,eACvFM,KADuF,CACjFE,IAAK,eAAe,yBAF/B,CADF;AAMD;;AAEM,eAAeC,yBAAf,CACLf,WADK,EAELgB,GAFK,EAGLC,OAHK,EAIU;AACf,MAAI,CAACA,OAAO,CAACC,MAAb,EAAqB;AAErB,QAAMjB,KAAK,GAAG;AACZgB,IAAAA,OAAO,EAAE,CAAC,GAAG,IAAIE,GAAJ,CAAQ,CAACH,GAAG,CAACC,OAAJ,IAAe,EAAhB,EAAoBG,MAApB,CAA2BH,OAA3B,CAAR,CAAJ;AADG,GAAd;AAGA,QAAMd,YAAY,GAAG,MAAM,iCAAkBH,WAAlB,EAA+BC,KAA/B,EAAsC;AAC/DG,IAAAA,yBAAyB,EAAE,IADoC;AAE/DiB,IAAAA,WAAW,EAAE;AAFkD,GAAtC,CAA3B;;AAIA,MAAIlB,YAAY,CAACE,IAAb,KAAsB,SAA1B,EAAqC;AACnCC,mBAAIK,GAAJ,CAAS,6BAA4BM,OAAO,CAACC,MAAR,KAAmB,CAAnB,GAAuB,EAAvB,GAA4B,GAAI,KAAID,OAAO,CAACK,IAAR,CAAa,IAAb,CAAmB,EAA5F;AACD,GAFD,MAEO;AACL,UAAMpB,UAAU,GAAG;AACjBe,MAAAA;AADiB,KAAnB;AAGAT,IAAAA,uBAAuB,CAACL,YAAY,CAACE,IAAd,EAAoBF,YAAY,CAACM,OAAjC,EAA2CP,UAA3C,CAAvB;AACD;AACF;;AAEM,SAASM,uBAAT,CAAiCH,IAAjC,EAA+CI,OAA/C,EAAgER,KAAhE,EAA4F;AACjGK,iBAAIC,gBAAJ;;AACA,MAAIF,IAAI,KAAK,MAAb,EAAqB;AACnB;AACAC,mBAAIK,GAAJ,CAAQL,eAAIM,KAAJ,CAAUC,MAAV,CAAiBJ,OAAjB,CAAR;AACD,GAHD,MAGO;AACLC,IAAAA,WAAW;AACZ;;AAEDa,EAAAA,4BAA4B,CAACtB,KAAD,CAA5B;AACA,QAAM,KAAIuB,2BAAJ,GAAN;AACD;;AAED,SAASD,4BAAT,CAAsCtB,KAAtC,EAAkE;AAChEK,iBAAIK,GAAJ,CAAQL,eAAIM,KAAJ,CAAUa,IAAV,CAAgB,8CAAhB,CAAR;;AACAnB,iBAAIoB,OAAJ;;AACApB,iBAAIK,GAAJ,CAAQgB,IAAI,CAACC,SAAL,CAAe3B,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAR;;AACAK,iBAAIoB,OAAJ;AACD","sourcesContent":["import { ExpoConfig, modifyConfigAsync } from '@expo/config';\n\nimport { SilentError } from '../../CommandError';\nimport Log from '../../log';\n\nexport async function attemptModification(\n  projectRoot: string,\n  edits: Partial<ExpoConfig>,\n  exactEdits: Partial<ExpoConfig>\n): Promise<void> {\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n  });\n  if (modification.type === 'success') {\n    Log.addNewLineIfNone();\n  } else {\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nfunction logNoConfig() {\n  Log.log(\n    Log.chalk.yellow(\n      `No Expo config was found. Please create an Expo config (${Log.chalk.bold`app.json`} or ${Log\n        .chalk.bold`app.config.js`}) in your project root.`\n    )\n  );\n}\n\nexport async function attemptAddingPluginsAsync(\n  projectRoot: string,\n  exp: Pick<ExpoConfig, 'plugins'>,\n  plugins: string[]\n): Promise<void> {\n  if (!plugins.length) return;\n\n  const edits = {\n    plugins: [...new Set((exp.plugins || []).concat(plugins))],\n  };\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n    skipPlugins: true,\n  });\n  if (modification.type === 'success') {\n    Log.log(`\\u203A Added config plugin${plugins.length === 1 ? '' : 's'}: ${plugins.join(', ')}`);\n  } else {\n    const exactEdits = {\n      plugins,\n    };\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nexport function warnAboutConfigAndThrow(type: string, message: string, edits: Partial<ExpoConfig>) {\n  Log.addNewLineIfNone();\n  if (type === 'warn') {\n    // The project is using a dynamic config, give the user a helpful log and bail out.\n    Log.log(Log.chalk.yellow(message));\n  } else {\n    logNoConfig();\n  }\n\n  notifyAboutManualConfigEdits(edits);\n  throw new SilentError();\n}\n\nfunction notifyAboutManualConfigEdits(edits: Partial<ExpoConfig>) {\n  Log.log(Log.chalk.cyan(`Please add the following to your Expo config`));\n  Log.newLine();\n  Log.log(JSON.stringify(edits, null, 2));\n  Log.newLine();\n}\n"],"file":"modifyConfigAsync.js"}